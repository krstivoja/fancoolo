<!DOCTYPE html>
<html>
<head>
    <title>Block Renderer Test</title>
    <script>
        // Mock WordPress globals for testing
        window.wp = {
            element: {
                createElement: function(tag, props, ...children) {
                    return { tag, props: props || {}, children };
                },
                cloneElement: function(element, props) {
                    return { ...element, props: { ...element.props, ...props } };
                },
                isValidElement: function(element) {
                    return element && typeof element === 'object' && element.tag;
                },
                useMemo: function(fn, deps) { return fn(); },
                useState: function(initial) { return [initial, function() {}]; },
                useEffect: function() {}
            },
            blockEditor: {
                InnerBlocks: function() { return { tag: 'InnerBlocks', props: {} }; },
                useBlockProps: function() { return { className: 'wp-block' }; }
            },
            components: {
                Spinner: function() { return { tag: 'Spinner', props: {} }; }
            },
            data: {
                select: function() {
                    return { getCurrentPostId: function() { return 123; } };
                }
            },
            apiFetch: function() {
                return Promise.resolve({ rendered: '<div class="test">Hello</div>' });
            }
        };
    </script>
    <script src="assets/js/block-renderer.js"></script>
</head>
<body>
    <h1>Block Renderer Tests</h1>
    <div id="results"></div>

    <script>
        function runTests() {
            const results = document.getElementById('results');

            // Test 1: Text node handling
            try {
                const textResult = window.FanculoBlockRenderer.renderServerContent(
                    'Just plain text',
                    { className: 'test-block' }
                );
                console.log('Text test:', textResult);
                results.innerHTML += '<p>✅ Text node test passed</p>';
            } catch (e) {
                results.innerHTML += '<p>❌ Text node test failed: ' + e.message + '</p>';
            }

            // Test 2: Single element with class merging
            try {
                const elementResult = window.FanculoBlockRenderer.renderServerContent(
                    '<div class="server-class" style="color: red;">Content</div>',
                    { className: 'block-class', style: { fontSize: '16px' } }
                );
                console.log('Element test:', elementResult);
                results.innerHTML += '<p>✅ Element merging test passed</p>';
            } catch (e) {
                results.innerHTML += '<p>❌ Element merging test failed: ' + e.message + '</p>';
            }

            // Test 3: Multiple InnerBlocks with unique keys
            try {
                const innerBlocksResult = window.FanculoBlockRenderer.parseServerContent(
                    '<div><innerblocks></innerblocks><div class="fanculo-block-inserter"></div></div>'
                );
                console.log('InnerBlocks test:', innerBlocksResult);
                results.innerHTML += '<p>✅ InnerBlocks unique keys test passed</p>';
            } catch (e) {
                results.innerHTML += '<p>❌ InnerBlocks test failed: ' + e.message + '</p>';
            }

            // Test 4: Attribute normalization
            try {
                const attrResult = window.FanculoBlockRenderer.parseServerContent(
                    '<input for="test" readonly class="input" />'
                );
                console.log('Attribute test:', attrResult);
                results.innerHTML += '<p>✅ Attribute normalization test passed</p>';
            } catch (e) {
                results.innerHTML += '<p>❌ Attribute normalization test failed: ' + e.message + '</p>';
            }

            results.innerHTML += '<p><strong>All basic tests completed!</strong></p>';
        }

        // Run tests when page loads
        window.onload = runTests;
    </script>
</body>
</html>